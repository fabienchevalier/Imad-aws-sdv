#CI qui teste le backend situ√© dans la branche master

name: CI Python

on: workflow_dispatch
  # push:
  #   branches: [master]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
      with:
        ref: 'master'

    - name: Set up Python 3.9
      uses: actions/setup-python@v2
      with:
        python-version: 3.9

    - name: Install Python dependencies
      run: |
        pwd && ls
        python -m pip install --upgrade pip
        cd backend-Python && pip install -r requirements.txt
    
    - name: Set up MongoDB
      uses: supercharge/mongodb-github-action@1.3.0
      with:
        mongodb-version: 6.0
        mongodb-username: root
        mongodb-password: example
        mongodb-db: employee_db


    - name: Run the API and tests
      uses: BerniWittmann/background-server-action@v1
      with:
        command: cd backend-Python && python uni_test.py
        start: cd backend-Python && flask run --host=0.0.0.0 --port=8080
      

      env:
        FLASK_ENV: development


    # - name: Deploy to dev-passed
    #   if: ${{ job.status == 'success' }}
    #   uses: peaceiris/actions-gh-pages@v3
    #   with:
    #     github_token: ${{ secrets.GITHUB_TOKEN }}
    #     publish_dir: .
    #     publish_branch: dev-passed
